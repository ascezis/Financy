import {Markup, Telegraf, Composer} from "telegraf";


const url = 'https://www.cbr-xml-daily.ru/daily_json.js';

//–ë–æ—Ç

const bot = new Telegraf('6736350377:AAFKVner7z3OqoGAZqnzzlWYFBSQrxDefBE');

//–ú–µ–Ω—é

const menu = [
    {
        command: '/start',
        description: '–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞'
    },
    {
        command: '/about',
        description: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ'
    },
    {
        command: '/restart',
        description: '–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞'
    },
]

bot.telegram.setMyCommands(menu);


//–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫—É—Ä—Å–æ–≤

const main_key = Markup.inlineKeyboard(
    [
        Markup.button.callback('–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç', '/rate'),
        Markup.button.callback('–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä', '/convert'),
        Markup.button.callback('–°–æ–≤–µ—Ç—ã', '/financy')
    ]
)

//–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞

const choice_keyboard = Markup.inlineKeyboard(
    [
        Markup.button.callback('‚ÇΩ =>', 'rub_in...'),
        Markup.button.callback('–î—Ä—É–≥–∞—è => ...', 'other_in...'),
    ]
)

const convert_rub_in_eng = Markup.inlineKeyboard(
    [
        Markup.button.callback('‚ÇΩ = $', 'rub_in_doll'),
        Markup.button.callback('‚ÇΩ = ‚Ç¨', 'rub_in_eur'),
        Markup.button.callback('‚ÇΩ = ¬£', 'rub_in_ster'),
    ]
)

const convert_eng_in_rub = Markup.inlineKeyboard(
    [
        Markup.button.callback('$ = ‚ÇΩ', 'rub_in_doll'),
        Markup.button.callback('‚Ç¨ = ‚ÇΩ', 'eur_in_rub'),
        Markup.button.callback('¬£ = ‚ÇΩ', 'ster_in_rub'),
    ]
)



const rate_keyboard = Markup.inlineKeyboard(
    [
        Markup.button.callback('$', 'dollars'),
        Markup.button.callback('‚Ç¨', 'euro'),
        Markup.button.callback('¬£', 'sterling'),
    ]
)


//–ë–∞–∑–∞

bot.hears('/start', msg => {
    msg.reply('üí∏–ü—Ä–∏–≤–µ—Ç, —è - Financy!üí∏ –í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤!üí∞ –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?', main_key)
})

//Restart

bot.hears('/restart', msg => {
    msg.reply('üõ†Ô∏è–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Å—å...üõ†Ô∏è');

    setTimeout(() => {

        bot.stop();
        bot.launch();

        msg.reply('ü§ñ–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!ü§ñ', main_key);
    }, 1000)
})

bot.action('/financy', msg => {
    msg.reply(
        '1. –°–æ–∑–¥–∞–π—Ç–µ –±—é–¥–∂–µ—Ç –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ—Å—å –µ–≥–æ. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã, —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ —É –≤–∞—Å –µ—Å—Ç—å –∏ –∫—É–¥–∞ –æ–Ω–∏ —É—Ö–æ–¥—è—Ç. üí∞üìä\n' +
        '\n' +
        '2. –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è - —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—É–º–º—É –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –Ω–∞ —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, –ø–µ–Ω—Å–∏—é –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ü–µ–ª–∏. üí∞üö®\n' +
        '\n' +
        '3. –ò–∑–±–µ–≥–∞–π—Ç–µ –¥–æ–ª–≥–æ–≤. –ï—Å–ª–∏ –≤—ã –≤—Å–µ –∂–µ –±–µ—Ä–µ—Ç–µ –∫—Ä–µ–¥–∏—Ç, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –µ–≥–æ –ø–æ–≥–∞—Å–∏—Ç—å –≤–æ–≤—Ä–µ–º—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤. üëçüí≥\n' +
        '\n' +
        '4. –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ —Å–≤–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ. –û–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –ª—é–¥–∏ –∏–º–µ—é—Ç –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞. üìöüíº\n' +
        '\n' +
        '5. –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å—Ç–µ —Å–≤–æ–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏. –ù–µ —Å—Ç–æ–∏—Ç –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏ –≤ –æ–¥–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å—Ç–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∏—Å–∫–æ–≤. üìàüí∏\n' +
        '\n' +
        '6. –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ –≤–∞–∂–Ω–æ. –ó–∞—â–∏—Ç–∏—Ç–µ —Å–µ–±—è –∏ —Å–≤–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ –æ—Ç –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤. üõ°Ô∏è\n' +
        '\n' +
        '7. –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–≤–æ—é –ø–µ–Ω—Å–∏—é. –ß–µ–º —Ä–∞–Ω—å—à–µ –≤—ã –Ω–∞—á–Ω–µ—Ç–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –Ω–∞ –ø–µ–Ω—Å–∏—é, —Ç–µ–º –±–æ–ª—å—à–µ —É –≤–∞—Å –±—É–¥–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—Ä–∞—Å—Ç–∏—Ç—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è. üï∞Ô∏èüí∞\n' +
        '\n' +
        '8. –û–±—Ä–∞–∑—É–π—Ç–µ—Å—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –ß–µ–º –±–æ–ª—å—à–µ –≤—ã –∑–Ω–∞–µ—Ç–µ –æ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö, —Ç–µ–º –ª—É—á—à–µ —Å–º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –¥–µ–Ω—å–≥–∞–º–∏. üìöüí∞\n' +
        '\n' +
        '9. –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –∫—Ä—É–ø–Ω—ã–º–∏ –ø–æ–∫—É–ø–∫–∞–º–∏. –ü—Ä–µ–∂–¥–µ —á–µ–º —Å–æ–≤–µ—Ä—à–∏—Ç—å –±–æ–ª—å—à—É—é –ø–æ–∫—É–ø–∫—É, —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥—É–º–∞–π—Ç–µ –∏ –∏–∑—É—á–∏—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. üí≥ü§î\n' +
        '\n' +
        '10. –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ —Å–≤–æ–∏—Ö —Ü–µ–ª—è—Ö. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é. üåüüéØ'
    )
})

//–í—ã—Ç–∞—Å–∫–∏–≤–∞—é –≤—Å–µ –≤–∞–ª—é—Ç—ã:

let USD;
let EUR;
let GBP;

//–ü–æ–ª—É—á–∞—é –∫—É—Ä—Å—ã –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç. –û–±—ä—è–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Ç.–∫ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ:

fetch(url) //–ö–ª–∞–¥—É —Å—é–¥–∞ —Å—Å—ã–ª–∫—É –ø–æ –∫–æ—Ç–æ—Ä–æ–π –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å
    .then(response => {
        if (!response.ok) {
            console.log('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ');
        }
        return response.json(); //–í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
    })
    .then(data => {

        //–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞
        USD = data.Valute.USD.Value;
        EUR = data.Valute.EUR.Value;
        GBP = data.Valute.GBP.Value;

    })

//–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç:

bot.action('/rate', msg => {
    msg.reply('–ö–∞–∫–æ–π –∫—É—Ä—Å –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º:', rate_keyboard);
})

//–î–æ–ª–ª–∞—Ä—ã

bot.action('dollars', msg => {
    msg.reply(`üìàüí≤ = ${USD.toFixed(2)} ‚ÇΩ`);
})

//–ï–≤—Ä–æ

bot.action('euro', msg => {
    msg.reply(`üìà‚Ç¨ = ${EUR.toFixed(2)} ‚ÇΩ`);
})

//–°—Ç–µ—Ä–ª–∏–Ω–≥–∏

bot.action('sterling', msg => {
    msg.reply(`üìà¬£ = ${GBP.toFixed(2)} ‚ÇΩ`);
})


//–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Ä—É–±–ª–µ–π –≤–æ —á—Ç–æ-—Ç–æ:

//–û—Å–Ω–æ–≤–Ω–æ–π –≤–æ–ø—Ä–æ—Å
bot.action('/convert', msg => {
    msg.reply('–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å?', choice_keyboard);
})

bot.action('rub_in...', msg => {
    msg.reply('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É', convert_rub_in_eng)
})

bot.action('other_in...', msg => {
    msg.reply('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É', convert_eng_in_rub)
})

//–†—É–±–ª–∏ –≤ –¥–æ–ª–ª–∞—Ä—ã:

bot.action('rub_in_doll',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö:')
    bot.use((ctx, next) => {
        let user_value = +(ctx.message.text);
        let result = user_value / USD;
        ctx.reply(` –≠—Ç–æ ${result.toFixed(2)} $`)
            .then(next);
    })
})

//–†—É–±–ª–∏ –≤ –µ–≤—Ä–æ

bot.action('rub_in_eur',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö:')
    bot.use((ctx) => {
        let user_value = +(ctx.message.text);
        let result = user_value / EUR;
        ctx.reply(` –≠—Ç–æ ${result.toFixed(2)} ‚Ç¨`)
    })
})

//–†—É–±–ª–∏ –≤ —Å—Ç–µ—Ä–ª–∏–Ω–≥–∏

bot.action('rub_in_ster',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö:')
    bot.use((ctx) => {
        let user_value = +(ctx.message.text);
        let result = user_value / GBP;
        ctx.reply(` –≠—Ç–æ ${result.toFixed(2)} ¬£`)
    })
})

//–î–æ–ª–ª–∞—Ä—ã:


//–î–æ–ª–ª–∞—Ä—ã –≤ —Ä—É–±–ª–∏

bot.action('doll_in_rub',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö:')
    bot.use((ctx) => {
        let user_value = +(ctx.message.text);
        let result = user_value * USD;
        ctx.reply(` –≠—Ç–æ ${result} ‚ÇΩ`)
    })
})

//–ï–≤—Ä–æ –≤ —Ä—É–±–ª–∏

bot.action('eur_in_rub',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ –µ–≤—Ä–æ:')
    bot.use((ctx) => {
        let user_value = +(ctx.message.text);
        let result = user_value * EUR;
        ctx.reply(` –≠—Ç–æ ${result} ‚ÇΩ`, convert_eng_in_rub)
    })
})

// –°—Ç–µ—Ä–ª–∏–Ω–≥–∏ –≤ —Ä—É–±–ª–∏

bot.action('eur_in_rub',  msg => {
    msg.reply('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Å—Ç–µ—Ä–ª–∏–Ω–≥–∞—Ö:')
    bot.use((ctx) => {
        let user_value = +(ctx.message.text);
        let result = user_value * GBP;
        ctx.reply(` –≠—Ç–æ ${result} ‚ÇΩ`)
    })
})

bot.hears('/about', msg => {
    msg.reply(`üí∞Financy –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —É–∑–Ω–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –≤–∞–ª—é—Ç, —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—É–±–ª–∏ –≤ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—É—é –≤–∞–ª—é—Ç—É –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Çüí∞`)
})


//–ó–∞–ø—É—Å–∫


bot.launch();
